<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<!--last modified on Saturday, October 03, 1998 04:19 PM -->
<HTML><!-- #BeginTemplate "/Templates/pink.dwt" --><!-- DW6 -->
<HEAD>
<!-- #BeginEditable "doctitle" -->
<TITLE>CapTP: The 4 Tables</TITLE>
<!-- #EndEditable --> 
<meta http-equiv=content-type content="text/html; charset=UTF-8">
<meta name="Author" content="Mark S. Miller">
<link rel=author rev=made title="Mark S. Miller">
<META NAME="description" CONTENT="E: Cryptographic Capabilities for Distributed Smart Contracting">
<META NAME="keywords" CONTENT="p2p, p2p language, p2p computing, p2p objects, secure p2p, p2p capabilities, object oriented p2p,
  capability-based p2p, Capability Security, Capabilities, Cryptography, Distributed Objects, Distributed
  Language, Distributed Capabilities, Lambda Calculus, Scripting Language, Distributed Language, Persistent
  Language, Persistent Capabilities, Persistent Objects, Java Shell, Capability Shell, Scripting Java, Smart
  Contracting, Agoric E-Commerce, Open Source, Message pipelining, quasi literal, vat, event loop, granovetter diagram ">
<link rel="stylesheet" href="../../../erights.css" type="text/css">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFEEDD" LINK="#0000FF" VLINK="#800080">
<TABLE BORDER="0" width="100%">
  <TR VALIGN="TOP"> 
    <TD WIDTH="10%">&nbsp; </TD>
    <TD> <TABLE BORDER="0" WIDTH="100%">
        <TR> 
          <TD ALIGN="LEFT" valign="top"> <table cellpadding="2">
              <tr> 
                <td valign="top" align="left" colspan="3"><a href="../../../index.html"><img src="../../../images/e-lambda.gif" width="32" height="32" border="0" alt="ERights Home"></a> 
                  <!-- #BeginEditable "Path" -->/&nbsp;<a href="../../index.html">elib</a>&nbsp;/&nbsp;<a href="../index.html">distrib</a>&nbsp;/&nbsp;<a href="index.html">captp</a>&nbsp;<!-- #EndEditable --></td>
              </tr>
              <tr> 
                <td valign="top" align="right"><!-- #BeginEditable "PrevButton" --><img src="../../../images/prev-gray.gif" width="64" height="32" alt="No Previous Sibling"><!-- #EndEditable --></td>
                <td valign="bottom" align="left"><!-- #BeginEditable "FirstButton" --><!-- #EndEditable --></td>
                <td valign="top" align="left"><!-- #BeginEditable "NextButton" --><a href="resolving.html" title="On to: CapTP: Resolving RemoteVows"><img src="../../../images/next.gif" width="64" height="32" alt="On to: CapTP: Resolving RemoteVows" border="0"></a><!-- #EndEditable --></td>
              </tr>
            </table></TD>
          <TD rowspan="2" ALIGN="RIGHT"> <P ALIGN="RIGHT"><FONT SIZE="7"><!-- #BeginEditable "BigTitle" --><FONT SIZE="7"><B>CapTP:<br>
              </B></FONT><font size="5"><b><font size="7">The Four Tables</font></b></font><!-- #EndEditable --></FONT> </TD>
        </TR>
        
      </TABLE>
      <hr> <!-- #BeginEditable "LongBody" --> 
      <h1 align="center"><img src="images/4tables.gif" width="606" height="623" alt="The Four Tables"></h1>
      <p>This (admittedly busy) diagram shows all the state implied by the CapTP 
        protocol for an inter-vat connection (a connection between two vats). 
        Notice the symmetry: The top half is identical to the bottom half rotated 
        180 degrees. Each half represents one of the vats participating in the 
        connection. Let's say the bottom half is Alice's vat and the top half 
        is Bob's vat. </p>
      <p>The purpose of CapTP is to stretch object references between vats so 
        that they follow the same dynamic capability logic as they do within a 
        vat. These object references are shown as the long blue arrows above. 
        Indeed, for many (not all!) purposes the programmers may ignore machine 
        boundaries and program as if they simply have a uniform sea of objects 
        constrained to follow capability rules. </p>
      <p>This property is known as <i><a href="../../concurrency/semi-transparent.html">Semi-Transparent</a> 
        Distributed Object Programming</i>. It is illustrated above by enclosing 
        the mechanisms internal to each side's Pluribus protocol handlers inside 
        the large grey rectangles. Ignoring the insides of the rectangles, we 
        see on the right object reference tails held by (unshown) objects in Bob's 
        vat pointing at various objects in Alice's vat, and vice versa on the 
        left. To understand the Pluribus protocol, you must understand the insides 
        of the grey rectangles. However, to understand and use E, you do not. 
        You need only understand how the semantics of inter-vat references differs 
        from the semantics of intra-vat references. (Far references are shown 
        crossing the boundaries because they do appear in the inter-vat semantics 
        of E.) Below we see the subset of the diagram relevant to the semantics 
        of E.</p>
      <p align="center"><img src="images/4tables-hide.gif" width="606" height="623" alt="What's Semantically Visible"></p>
      <p>The trapezoids in the first diagram are the four tables. They are integer 
        indexed tables, and come in pairs. A particular index number in the Imports 
        table represents a blue object-reference arrow leaving this vat for the 
        other vat. The same number in the other's Exports table must correspond 
        to the entry into that vat of the same reference arrow. Likewise, with 
        a reference leaving via an index in a Questions table and entering at 
        the same index in the other vat's Answers table. This difference in direction 
        is the distinction between the two rows of the following matrix:</p>
      <a name="why4"></a>
      <table cellpadding="12">
        <tr> 
          <th> 
            <div align="center"></div>
          </th>
          <th> 
            <p>We generate<br>
              OID and pos</p>
          </th>
          <th>Remote end generates<br>
            OID and pos</th>
        </tr>
        <tr> 
          <th> 
            <div align="center">Outgoing remote ref.<br>
              We have tail,<br>
              remote has head</div>
          </th>
          <td bgcolor="#F898F8"> 
            <p align="center">Questions<br>
              t &lt; 0</p>
          </td>
          <td bgcolor="#F85800"> 
            <div align="center">Imports<br>
              t &gt; 0</div>
          </td>
        </tr>
        <tr> 
          <th> 
            <div align="center">Incoming remote ref.<br>
              We have head,<br>
              remote has tail</div>
          </th>
          <td bgcolor="#F8F800"> 
            <div align="center">Exports<br>
              h &gt; 0</div>
          </td>
          <td bgcolor="#B800B8"> 
            <div align="center">Answers<br>
              h &lt; 0</div>
          </td>
        </tr>
      </table>
      <p>There are four tables rather than two because of the orthogonal distinction 
        that separates the columns. In order for a reference to span the inter-vat 
        gap, one side, let's say Alice's vat, must first allocate an index for 
        it in one of her tables, and then inform Bob's vat so Bob's vat can make 
        the corresponding entry in the corresponding table. Bob's vat, of course, 
        is doing likewise; so the two vats must be sure their allocations don't 
        collide.</p>
      <p>When Alice's vat allocates a place for the incoming (arrowhead) end of 
        an object reference, she uses her Exports table. When Bob's vat hears 
        about this, he follows her lead and makes the corresponding entry in his 
        Imports table. When Alice's vat allocates a place for the outgoing (tail) 
        end of an object reference, she uses her Questions table. Bob's vat again 
        follows her lead and makes the corresponding entry in his Answers table. 
        When would Alice find herself allocating an arrowtail vs an arrowhead? 
        Let's say that Alice already holds a remote reference to Bob and a local 
        reference to Carol (implying that Carol lives in Alice's vat as well), 
        and Alice decides to send Carol to Bob in a message:</p>
      <blockquote> 
        <pre>def result := bob &lt;- foo(carol)</pre>
      </blockquote>
      <p>Alice's vat would allocate an index for Carol in her Exports table, since 
        the reference to Carol must be pointing into Alice's vat. On the other 
        hand, Alice's vat would allocate an index for <tt>result</tt> in her 
        Questions table, since the outgoing reference to the result is in Alice's 
        vat, but it is a RemotePromise (a kind of Promise) for a result whose value 
        will be determined by Bob's response to the message.</p>
      <!-- #EndEditable --></TD>
    <TD WIDTH="10%" rowspan="2" align="right" valign="bottom"> </TD>
  </TR>
  <TR VALIGN="TOP"> 
    <TD WIDTH="10%">&nbsp;</TD>
    <TD> <hr>
      Unless stated otherwise, all text on this page which is either unattributed 
      or by Mark S. Miller is hereby placed in the public domain. 
        <div align="center"> 
        <table width="100%" cellpadding="4" cellspacing="0">
          <tr> 
            <td> <table align="left" cellpadding="2">
                <tr> 
                  <td valign="top" align="left" colspan="3"><a href="../../../index.html"><img src="../../../images/e-lambda.gif" width="32" height="32" border="0" alt="ERights Home"></a> 
                    <!-- #BeginEditable "Path2" -->/&nbsp;<a href="../../index.html">elib</a>&nbsp;/&nbsp;<a href="../index.html">distrib</a>&nbsp;/&nbsp;<a href="index.html">captp</a>&nbsp;<!-- #EndEditable --></td>
                </tr>
                <tr> 
                  <td valign="top" align="right"><!-- #BeginEditable "PrevButton2" --><img src="../../../images/prev-gray.gif" width="64" height="32" alt="No Previous Sibling"><!-- #EndEditable --></td>
                  <td valign="bottom" align="left"><!-- #BeginEditable "FirstButton2" --><!-- #EndEditable --></td>
                  <td valign="top" align="left"><!-- #BeginEditable "NextButton2" --><a href="resolving.html" title="On to: CapTP: Resolving RemoteVows"><img src="../../../images/next.gif" width="64" height="32" alt="On to: CapTP: Resolving RemoteVows" border="0"></a><!-- #EndEditable --></td>
                </tr>
              </table></td>
            <td> <table border="3" align="center" cellpadding="6" cellspacing="3">
                <tr> 
                  <td> <div align="center"><font size="-1"><a href="../../index.html">ELib</a> 
                      &nbsp;&nbsp; <a href="../../../elang/index.html">E Language</a> 
                      &nbsp;&nbsp; <a href="../../../smart-contracts/index.html">Smart 
                      Contracts</a> &nbsp;&nbsp; <a href="../../../related.html">Related</a> 
                      </font></div></td>
                </tr>
                <tr> 
                  <td> <div align="center"><font size="-1"><a href="../../../download/index.html">Download</a> 
                      &nbsp;&nbsp; <a href="http://mumble.net/e/faq.html">FAQ</a> 
                      &nbsp;&nbsp; <a href="../../../javadoc/index.html">API</a> &nbsp;&nbsp; 
                      <a href="http://www.eros-os.org/pipermail/e-lang/">Mail 
                      Archive</a> &nbsp;&nbsp; <a href="../../../donate.html">Donate</a></font></div></td>
                </tr>
              </table></td>
            <td><div align="right"> 
                <p><a href="https://sourceforge.net/tracker/?func=add&amp;group_id=75274&amp;atid=551529"><i>report 
                  bug</i></a> (including <a href="http://validator.w3.org/check/referer">invalid 
                  html</a>) </p>
                <p><a href="http://www.epic.org/crypto/"><img src="../../../images/key.gif" width="37" height="19" alt="Golden Key Campaign" border="0"></a>&nbsp;<a href="http://www.eff.org/br/"><img src="../../../images/ribbon.gif" width="18" height="30"
alt="Blue Ribbon Campaign" border="0"></a></div></td>
          </tr>
          
        </table>
      </div></TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate --></HTML>
